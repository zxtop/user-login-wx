# user-login-wx
微信用户登陆

1.用户登录流程

• 小程序：用户使用的客户端，由于小程序运行在微信之上，因此小程序可以通过API获取微信用户的身份信息。
• 开发者服务器：小程序的后端服务器，用于为小程序用户提供服务。
• 微信接口服务：微信为开发者服务器提供的接口。

在明确了这3个角色的作用后，下面针对登录流程的具体细节进行讲解。

（1）小程序获取code在小程序中通过 wx.login()获取登录凭证 code,
    code 由小程序内部自动生成，每次调用wx.login()获得的code都不同。需要注意的是，code有效期为5分钟，且被微信接口服务验证一次后就会失效。
    
（2）小程序将code发送给开发者服务器在获取code后，使用wx.request()将code发送给开发者服务器。

（3）开发者服务器通过微信接口服务校验登录凭证开发者服务器将 AppId、AppSecret、code 发送给微信接口服务校验登录凭证，
    如果校验成功，返回session_key和openid等。其中，AppId是小程序的唯一标识，AppSecret是小程序的密钥，对于微信接口服务而言，它们相当于小程序账号的id和密码。
    微信接口服务校验成功后会返回 session_key 和 openid,openid 是用户的唯一标识， session_key是对用户数据进行加密签名的密钥，具体会在后面讲解。需要注意的是，
    openid并不等同于微信用户id，同一个微信用户在不同AppId小程序中的openid是不同的。
    
 （4）开发者服务器自定义登录态在用户登录成功后，开发者服务器将openid和session_key保存，然后生成一个自定义登录态的token（令牌）响应给小程序，
 通过token可以查询到openid和session_key。小程序下次请求时只要携带token，就可以证明用户已经登录。
